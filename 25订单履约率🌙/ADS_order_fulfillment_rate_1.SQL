COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.PERIOD IS '日期';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.PRODUCTION_LINE IS '生产线';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.FACTORY IS '厂区';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.DELAY_3_6_PRODUCTION IS '订单拖期3-6天（生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.DELAY_7_PRODUCTION IS '订单拖期7天以上（生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.DELAY_3_6_OTHER IS '订单拖期3-6天（非生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.DELAY_7_OTHER IS '订单拖期7天以上（非生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.LAST_DELAY_3_6_PRODUCTION IS '上月订单拖期3-6天（生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.LAST_DELAY_7_PRODUCTION IS '上月订单拖期7天以上（生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.LAST_DELAY_3_6_OTHER IS '上月订单拖期3-6天（非生产）';
COMMENT ON COLUMN ADS_ORDER_FULFILLMENT_RATE_1.LAST_DELAY_7_OTHER IS '上月订单拖期7天以上（非生产）';


INSERT INTO ADS_ORDER_FULFILLMENT_RATE_1 (
    PERIOD,
    PRODUCTION_LINE,
    FACTORY,
    DELAY_3_6_PRODUCTION,
    DELAY_7_PRODUCTION,
    DELAY_3_6_OTHER,
    DELAY_7_OTHER,
    LAST_DELAY_3_6_PRODUCTION,
    LAST_DELAY_7_PRODUCTION,
    LAST_DELAY_3_6_OTHER,
    LAST_DELAY_7_OTHER,
    ETL_CRT_DT,
    ETL_UPD_DT
)
SELECT 
    C.PERIOD,
    C.PRODUCTION_LINE,
    C.FACTORY,
    C.DELAY_3_6_PRODUCTION,
    C.DELAY_7_PRODUCTION,
    C.DELAY_3_6_OTHER,
    C.DELAY_7_OTHER,
    LAG(C.DELAY_3_6_PRODUCTION, 1) OVER (PARTITION BY C.PRODUCTION_LINE, C.FACTORY ORDER BY C.PERIOD) AS LAST_DELAY_3_6_PRODUCTION,
    LAG(C.DELAY_7_PRODUCTION, 1) OVER (PARTITION BY C.PRODUCTION_LINE, C.FACTORY ORDER BY C.PERIOD) AS LAST_DELAY_7_PRODUCTION,
    LAG(C.DELAY_3_6_OTHER, 1) OVER (PARTITION BY C.PRODUCTION_LINE, C.FACTORY ORDER BY C.PERIOD) AS LAST_DELAY_3_6_OTHER,
    LAG(C.DELAY_7_OTHER, 1) OVER (PARTITION BY C.PRODUCTION_LINE, C.FACTORY ORDER BY C.PERIOD) AS LAST_DELAY_7_OTHER,
    SYSDATE,
    SYSDATE
FROM MDDWS.DWS_ORDER_FULFILLMENT_RATE_1 C;
