
INSERT INTO ADS_WEIGHT_PIECE_RANK_BIKB (
    GROUP_ID,
    TOTAL_CNT,
    TOTAL_WEIGHT,
    CNT_RANK_DESC,
    CNT_RANK_ASC,
    WEIGHT_RANK_DESC,
    WEIGHT_RANK_ASC
)
WITH NEWDATE AS (   
    SELECT MAX(TRUNC(PERIOD,'MM')) AS MAX_DATE FROM MDDWD.DWD_WEIGHT_PIECE_BIKB
),
LATESTMONTHDATA AS (
    SELECT 
        PERIOD,
        GROUP_ID,
        CNT,
        UNIT_WEIGHT,
        CNT * UNIT_WEIGHT AS TOTAL_WEIGHT
    FROM MDDWD.DWD_WEIGHT_PIECE_BIKB
    WHERE TRUNC(PERIOD, 'MM') = (SELECT MAX_DATE FROM NEWDATE)
),
SUM_WP AS (
    SELECT
        GROUP_ID,
        SUM(CNT) AS TOTAL_CNT,
        SUM(CNT * UNIT_WEIGHT) AS TOTAL_WEIGHT
    FROM LATESTMONTHDATA
    GROUP BY GROUP_ID
)
SELECT
    GROUP_ID,
    TOTAL_CNT,
    TOTAL_WEIGHT,
    -- 件数正排名（从高到低）
    RANK() OVER (ORDER BY TOTAL_CNT DESC) AS CNT_RANK_DESC,
    -- 件数倒排名（从低到高）
    RANK() OVER (ORDER BY TOTAL_CNT ASC) AS CNT_RANK_ASC,
    -- 重量正排名（从高到低）
    RANK() OVER (ORDER BY TOTAL_WEIGHT DESC) AS WEIGHT_RANK_DESC,
    -- 重量倒排名（从低到高）
    RANK() OVER (ORDER BY TOTAL_WEIGHT ASC) AS WEIGHT_RANK_ASC
FROM SUM_WP
WHERE GROUP_ID IS NOT NULL
ORDER BY TOTAL_CNT DESC;