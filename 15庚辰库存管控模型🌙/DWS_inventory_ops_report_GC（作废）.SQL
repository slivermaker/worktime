SELECT 
    B.PERIOD_DATE       -- 日期
    ,A.PRODUCT_TPYE_SC        --类型  
    ,A.PRODUCT_CODE        --产品编码
    ,D.BEGINNING_INVENTORY ---期初结存  ODS_ERP2013.ODS_TPC_HWJCB   
    ,E.MONTHLY_IN_QUANTITY ---月入库量  ODS_ERP2013.ODS_TPC_BZRKB
    ,F.MONTHLY_OUT_QUANTITY  ---月出库量ODS_ERP2013.ODS_XSCKSJ        
FROM 
    MDDWD.DWD_STKCFLB A
    CROSS JOIN DIM.MONTH_D B --a表作为主表，扩充日期
    LEFT JOIN ODS_ERP2013.ODS_TPC_BZRKB D --取昨结存作为 期初结存
    on A.PRODUCT_CODE = D.PZ || D.GG
    AND B.PERIOD_DATE = D.PERIOD
    LEFT JOIN ODS_ERP2013.ODS_TPC_BZRKB E ---入库
    ON A.PRODUCT_CODE = E.PZ || E.GG
    AND B.PERIOD_DATE = E.PERIOD
    LEFT JOIN ODS_ERP2013.ODS_XSCKSJ F --出库
    ON A.PRODUCT_CODE = F.WLBM
    AND TO_DATE (F.CKRQ, 'YY.MM.DD') = B.PERIOD_DATE
WHERE
    B.PERIOD_DATE > DATE '2023-12'
    AND B.PERIOD_DATE < SYSDATE
    AND A.PRODUCT_CODE IN (
        SELECT PRODUCT_CODE
        FROM MDDWD.DWD_XSGXDYB
        WHERE
            PRODUCT.SORT1 = '铁球'
            AND START_TIME <= SYSDATE
            AND END_TIME >= SYSDATE --作为限制
    ) C