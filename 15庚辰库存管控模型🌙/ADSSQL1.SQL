CREATE TABLE MDADS.ADS_INVENTORY_OPS_ANALYSIS (
    PERIOD_DATE DATE,                          -- 日期
    PRODUCT_TYPE_SC VARCHAR2(4000),           -- 产品类型
    PRODUCT_CODE VARCHAR2(4000),              -- 产品编码（品种加规格）
    INVENTORY_RATIO NUMBER,                    -- 库存占比
    STOCK_FLOOR NUMBER,                        -- 库存下限
    STOCK_CEILING NUMBER,                      -- 库存上限
    SALES_ACTIVITY_RATIO NUMBER,               -- 动销率
    BEGINNING_INVENTORY NUMBER,                -- 期初库存
    SAMEP_MONTH_INVENTORY NUMBER,              -- 同期期初结存量
    LAST_MONTH_INVENTORY NUMBER,               -- 上月期初结存量
    MONTHLY_IN_QUANTITY NUMBER,                -- 月入库量
    SAMEP_MONTH_IN_QUANTITY NUMBER,            -- 同期入库
    LAST_MONTH_IN_QUANTITY NUMBER,              -- 上月入库
    MONTHLY_OUT_QUANTITY NUMBER,                -- 月出库
    SAMEP_MONTH_OUT_QUANTITY NUMBER,            -- 同期出库
    LAST_MONTH_OUT_QUANTITY NUMBER              -- 上月出库

);

COMMENT ON TABLE MDADS.ADS_INVENTORY_OPS_ANALYSIS IS '库存运营综合分析表（庚辰项目）';

COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.PERIOD_DATE IS '统计日期';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.PRODUCT_TYPE_SC IS '产品类型分类';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.PRODUCT_CODE IS '产品编码（品种_规格）';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.INVENTORY_RATIO IS '库存占比';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.STOCK_FLOOR IS '库存下限';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.STOCK_CEILING IS '库存上限';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.SALES_ACTIVITY_RATIO IS '动销率';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.BEGINNING_INVENTORY IS '本月期初库存量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.SAMEP_MONTH_INVENTORY IS '同期期初库存量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.LAST_MONTH_INVENTORY IS '上月期初库存数量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.MONTHLY_IN_QUANTITY IS '当月入库总量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.SAMEP_MONTH_IN_QUANTITY IS '同期入库总量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.LAST_MONTH_IN_QUANTITY IS '上月入库总量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.MONTHLY_OUT_QUANTITY IS '当月出库量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.SAMEP_MONTH_OUT_QUANTITY IS '同期出库量';
COMMENT ON COLUMN MDADS.ADS_INVENTORY_OPS_ANALYSIS.LAST_MONTH_OUT_QUANTITY IS '上月出库量';















TRUNCATE TABLE MDADS.ADS_INVENTORY_OPS_ANALYSIS;

INSERT INTO MDADS.ADS_INVENTORY_OPS_ANALYSIS (
    PERIOD_DATE,                          -- 日期
    PRODUCT_TYPE_SC,                      -- 产品类型
    PRODUCT_CODE,                         -- 产品编码（品种加规格）
    INVENTORY_RATIO,                      -- 库存占比
    STOCK_FLOOR,                          -- 库存下限
    STOCK_CEILING,                        -- 库存上限
    SALES_ACTIVITY_RATIO,                 -- 动销率
    BEGINNING_INVENTORY,                  -- 期初库存
    SAMEP_MONTH_INVENTORY,                -- 上年同月期初结存量
    LAST_MONTH_INVENTORY,                 -- 上月期初结存量
    MONTHLY_IN_QUANTITY,                  -- 月入库量
    SAMEP_MONTH_IN_QUANTITY,              -- 同期入库
    LAST_MONTH_IN_QUANTITY,               -- 上月入库
    MONTHLY_OUT_QUANTITY,                 -- 月出库
    SAMEP_MONTH_OUT_QUANTITY,             -- 同期出库
    LAST_MONTH_OUT_QUANTITY,               -- 上月出库
    ending_inventory ,                     --
    samep_month_end_inventory ,
    last_month_end_inventory ,
    START_DATE,
    END_DATE
)

SELECT
    A.PERIOD                       ---日期
    ,A.PRODUCT_TYPE_SC                   --产品类型
    ,A.PRODUCT_CODE                     --产品编码（品种加规格）
    ,A.INVENTORY_RATIO                  --库存占比
    ,A.STOCK_FLOOR                   --库存下限
    ,A.STOCK_CEILING                      --库存上限
    ,A.SALES_ACTIVITY_RATIO             ---动销率
    ,C.BEGINNING_INVENTORY               --期初库存
    ,C.SAMEP_MONTH_INVENTORY            --上年同月期初结存量
    ,C.LAST_MONTH_INVENTORY             --上月期初结存量
    ,D.MONTHLY_IN_QUANTITY              --月入库量
    ,D.SAMEP_MONTH_IN_QUANTITY              --同期入库
    ,D.LAST_MONTH_IN_QUANTITY               --上月入库
    ,E.MONTHLY_OUT_QUANTITY                 --月出库
    ,E.SAMEP_MONTH_OUT_QUANTITY             --同期出库
    ,E.LAST_MONTH_OUT_QUANTITY              --上月出库
    ,F.ending_inventory 
    ,F.samep_month_end_inventory 
    ,F.last_month_end_inventory 
    ,A.START_DATE
    ,A.END_DATE


FROM
    MDDWD.DWD_STKCFLB A
    LEFT JOIN  MDDWS.DWS_INVENTORY_OPS_BEGIN C --期初结存
        ON A.PERIOD=C.PERIOD AND A.PRODUCT_CODE=C.PRODUCT_CODE AND C.PERIOD BETWEEN A.START_DATE AND A.END_DATE
    LEFT JOIN MDDWS.DWS_INVENTORY_OPS_RK D--月入库量
        on A.PERIOD=D.PERIOD_DATE AND A.PRODUCT_CODE=D.PRODUCT_CODE AND D.PERIOD_DATE BETWEEN A.START_DATE AND A.END_DATE
    LEFT JOIN MDDWS.DWS_INVENTORY_OPS_CK E--月出库量
        on A.PERIOD=E.PERIOD AND A.PRODUCT_CODE=E.PRODUCT_CODE AND E.PERIOD BETWEEN A.START_DATE AND A.END_DATE
    LEFT JOIN MDDWS.DWS_INVENTORY_OPS_END F--期末结存
         on A.PERIOD=F.PERIOD AND A.PRODUCT_CODE=F.PRODUCT_CODE AND F.PERIOD BETWEEN A.START_DATE AND A.END_DATE
WHERE
    A.PERIOD > DATE '2023-12-1'
    AND A.PERIOD < SYSDATE
    AND A.PRODUCT_CODE IN (
            SELECT PRODUCT_CODE
            FROM MDDWD.DWD_XSGXDYB C
            WHERE
                C.PRODUCT_SORT1 = '球铁'
                AND C.START_TIME <= SYSDATE
                AND C.END_TIME >= SYSDATE
    ) 