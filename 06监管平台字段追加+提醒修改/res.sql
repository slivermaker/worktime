

~~~sql
-- 1. DWD_R250521002_J01
ALTER TABLE DWD_R250521002_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250521002_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 2. DWD_R250412002_J01
ALTER TABLE DWD_R250412002_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250412002_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 3. DWD_R250417001_J01
ALTER TABLE DWD_R250417001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 4. DWD_R250417001_J03
ALTER TABLE DWD_R250417001_J03 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417001_J03.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 5. DWD_R250417003_J01
ALTER TABLE DWD_R250417003_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417003_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 6. DWD_R250425001_J01
ALTER TABLE DWD_R250425001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 7. DWD_R250425001_J02
ALTER TABLE DWD_R250425001_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425001_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 8. DWD_R250425001_J03
ALTER TABLE DWD_R250425001_J03 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425001_J03.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 9. DWD_R250425001_J04
ALTER TABLE DWD_R250425001_J04 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425001_J04.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 10. DWD_R250425002_J01
ALTER TABLE DWD_R250425002_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425002_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 11. DWD_R250425003_J01
ALTER TABLE DWD_R250425003_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425003_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 12. DWD_R250425003_J02
ALTER TABLE DWD_R250425003_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425003_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 13. DWD_R250425003_J03
ALTER TABLE DWD_R250425003_J03 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425003_J03.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 14. DWD_R250425003_J04
ALTER TABLE DWD_R250425003_J04 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425003_J04.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 15. DWD_R250425004_J01
ALTER TABLE DWD_R250425004_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425004_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 16. DWD_R250425004_J02
ALTER TABLE DWD_R250425004_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425004_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 17. DWD_R250425004_J03
ALTER TABLE DWD_R250425004_J03 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425004_J03.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 18. DWD_R250425004_J04
ALTER TABLE DWD_R250425004_J04 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425004_J04.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 19. DWD_R250425005_J01
ALTER TABLE DWD_R250425005_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250425005_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 20. DWD_R050418001_J01
ALTER TABLE DWD_R050418001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R050418001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 21. DWD_R250417002_J01
ALTER TABLE DWD_R250417002_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417002_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 22. DWD_R250417002_J02
ALTER TABLE DWD_R250417002_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417002_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 23. DWD_R250417002_J03
ALTER TABLE DWD_R250417002_J03 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417002_J03.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 24. DWD_R250421001_J01
ALTER TABLE DWD_R250421001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250421001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 25. DWD_R250421002_J01
ALTER TABLE DWD_R250421002_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250421002_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 26. DWD_R250417004_J02
ALTER TABLE DWD_R250417004_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417004_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 27. DWD_R250417004_J01
ALTER TABLE DWD_R250417004_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417004_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 28. DWD_R250417005_J01
ALTER TABLE DWD_R250417005_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417005_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 29. DWD_R250512001_J01
ALTER TABLE DWD_R250512001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250512001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 30. DWD_R250507001_J01
ALTER TABLE DWD_R250507001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250507001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 31. DWD_R250514001_J01
ALTER TABLE DWD_R250514001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250514001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 32. DWD_R250514001_J02
ALTER TABLE DWD_R250514001_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250514001_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 33. DWD_R250521001_J01
ALTER TABLE DWD_R250521001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250521001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 34. DWD_R250521003_J01
ALTER TABLE DWD_R250521003_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250521003_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 35. DWD_R250521004_J01
ALTER TABLE DWD_R250521004_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250521004_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 36. DWD_R250521004_J02
ALTER TABLE DWD_R250521004_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250521004_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 37. DWD_R250604001_J01
ALTER TABLE DWD_R250604001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250604001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 38. DWD_R250604001_J02
ALTER TABLE DWD_R250604001_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250604001_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 39. DWD_R250604001_J03
ALTER TABLE DWD_R250604001_J03 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250604001_J03.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 补充遗漏的表1
ALTER TABLE DWD_R250417001_J02 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250417001_J02.IS_WORKDAY IS '是否为工作日（1=是，0=否）';

-- 补充遗漏的表2
ALTER TABLE DWD_R250412001_J01 ADD IS_WORKDAY NUMBER DEFAULT 1;
COMMENT ON COLUMN DWD_R250412001_J01.IS_WORKDAY IS '是否为工作日（1=是，0=否）';
~~



~~~sql

/*
	Description：更新监管表IS_WORKDAY 是否工作日
	Author：尹依哲
	Create date：2025年6月16日14:51:51
	Modify：
	Update date：
*/



BEGIN
  DECLARE
    V_SUCCESS_COUNT NUMBER := 0;  -- 记录成功更新的表数量
    V_ERROR_COUNT NUMBER := 0; -- 记录更新失败的表数量
    V_TOTAL_COUNT NUMBER := 0; -- 记录总表数量
  BEGIN
    -- 循环生效的监管表名
    FOR R_TABLE IN (
      SELECT 'DWD' || JOB_CODE AS TABLE_NAME
      FROM DWD_DATA_CHECK_JOB
      WHERE JOB_CODE IS NOT NULL AND IS_ENABLE = '是' 
    ) LOOP

    
      V_TOTAL_COUNT := V_TOTAL_COUNT + 1;
      BEGIN
        EXECUTE IMMEDIATE '
          MERGE INTO ' || R_TABLE.TABLE_NAME || ' T
          USING (
            SELECT PERIOD_DATE, IS_WORKDAY 
            FROM MDDIM.DIM_DAY_D 
            WHERE  TRUNC(PERIOD_DATE,''DD'') = TRUNC(SYSDATE,''DD'')
          ) D
          ON (TRUNC(T.CHECK_TIME) = D.PERIOD_DATE)
          WHEN MATCHED THEN
            UPDATE SET T.IS_WORKDAY = D.IS_WORKDAY';

        V_SUCCESS_COUNT := V_SUCCESS_COUNT + 1;
        DBMS_OUTPUT.PUT_LINE('成功更新: ' || R_TABLE.TABLE_NAME || ' - 影响行数: ' || SQL%ROWCOUNT);
        
        COMMIT;
        -- 执行SQL异常回滚
      EXCEPTION
        WHEN OTHERS THEN
          ROLLBACK;
          V_ERROR_COUNT := V_ERROR_COUNT + 1;
          DBMS_OUTPUT.PUT_LINE('更新失败: ' || R_TABLE.TABLE_NAME || ' - ' || SUBSTR(SQLERRM, 1, 200));
      END;
    END LOOP;
    DBMS_OUTPUT.PUT_LINE('-------------------------------------------');
    DBMS_OUTPUT.PUT_LINE('批量更新完成');
    DBMS_OUTPUT.PUT_LINE('总表数: ' || V_TOTAL_COUNT);
    DBMS_OUTPUT.PUT_LINE('成功: ' || V_SUCCESS_COUNT);
    DBMS_OUTPUT.PUT_LINE('失败: ' || V_ERROR_COUNT);
  END;
END;
~~~